import{S as Ce,C as A,H as ye,D as xe,G as ke,P as T,W as Ae,s as He,a as Me,b as De,c as Le,d as Ee,A as ee,e as q,E as Pe,R as Ve,f as Ge,g as Fe,V as L,h as Oe,O as We,i as ze,j as Te,k as Re,F as Be,B as K,l as O,U as Ie,m as je,M as Ue,n as Ne,o as Xe,p as Je,q as Ye,T as qe,r as Ke,t as Qe,u as Q,v as Ze,w as $e}from"./SMAAPass.9cd29069.js";const p=function(t,e,n,a,i,o,s,d,h,f){this.path=t,this.animData=null,this.location_x=e,this.location_y=n,this.location_z=a,this.head=null,this.tail=null,this.bones=[],this.showVis=i,this.partialhuman=h,this.showLabelinstant=!1,f&&(this.showLabelinstant=!0),this.fakeMeshGeometry=new Re(5,5,5,5,15,5,30),this.mesh=null,this.meshScale=1,this.skeleton=null,this.boneVisHelper=null,this.verticesVisHelper=null,this.isReConstructed=o,this.color1=new A(0,0,1),this.color2=new A(0,1,0),this.isReConstructed&&(this.color1=new A(1,0,0),this.color2=new A(1,.5,0)),this.transparentBone=!1,s&&(this.transparentBone=!0),this.transparentVertices=!1,d&&(this.transparentVertices=!0),this.Label=null,this.tracks=[],this.clip=null,this.mixer=null,this.clipAction=null};p.prototype={constructor:p,initContent:function(){this._reportProgress({detail:{text:"Loading: "+this.path}});const t=new Be,e=this,n=function(a){console.log("Loading complete: "+e.path),e._reportProgress({detail:{text:""}}),e.animData=JSON.parse(a);const i=[e.animData.length,e.animData[0].length,e.animData[0][0].length];console.log(i),i[1]===21?(e.head=[0,1,2,3,0,5,6,7,0,9,10,11,0,13,14,15,0,17,18,19],e.tail=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],e.meshScale=1.5):i[1]===38&&e.partialhuman?(e.head=[0,1,2,3,4,5,0,7,8,9,10,11,0,13,14,15,16,17,18,15],e.tail=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],e.meshScale=2):(e.head=[0,1,2,3,4,5,0,7,8,9,10,11,0,13,14,15,16,17,18,15,20,21,22,23,24,25,23,27,15,29,30,31,32,33,34,32,36],e.tail=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37],e.meshScale=2),e.createSkeleton(),e.createFakeSkinMesh(),e.createSkinMesh(),e.setUpAnimation()};t.load(e.path,n)},loadDataFromFile:function(t){this.animData=JSON.parse(t);const e=[this.animData.length,this.animData[0].length,this.animData[0][0].length];console.log(e),e[1]===21?(this.head=[0,1,2,3,0,5,6,7,0,9,10,11,0,13,14,15,0,17,18,19],this.tail=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]):(this.head=[0,1,2,3,4,5,0,7,8,9,10,11,0,13,14,15,16,17,18,15,20,21,22,23,24,25,23,27,15,29,30,31,32,33,34,32,36],this.tail=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37],this.meshScale=.07),this.createSkeleton(),this.createFakeSkinMesh(),this.createSkinMesh(),this.setUpAnimation()},_reportProgress:function(t){let e="";t.detail!==null&&t.detail!==void 0&&t.detail.text&&(e=t.detail.text),console.log("Progress: "+e)},createSkeleton:function(){let t=new K;t.name="bone_0",this.bones.push(t);let e=[],n=this.animData[0][0][0],a=this.animData[1][0][0],i=this.animData[2][0][0];t.position.set(n,a,i),e.push(t.position);for(let o=1;o!==this.head.length+1;++o){let s=new K;this.bones[this.head[o-1]].add(s),s.name="bone_"+this.tail[o-1],this.bones.push(s);let d=this.head[o-1];n=this.animData[0][o][0]-this.animData[0][d][0],a=this.animData[1][o][0]-this.animData[1][d][0],i=this.animData[2][o][0]-this.animData[2][d][0],s.position.set(n,a,i),e.push(s.position)}},createFakeSkinMesh:function(){const t=this.fakeMeshGeometry.attributes.position,e=new O,n=[],a=[];for(let i=0;i<t.count;i++){e.fromBufferAttribute(t,i);const o=1,s=1;n.push(o,o+1,0,0),a.push(1-s,s,0,0)}this.fakeMeshGeometry.setAttribute("skinIndex",new Ie(n,4)),this.fakeMeshGeometry.setAttribute("skinWeight",new je(a,4))},createSkinMesh:function(){const t=new Ue({color:16737095,wireframe:!0});this.mesh=new Ne(this.fakeMeshGeometry,t),this.skeleton=new Xe(this.bones);const e=this.skeleton.bones[0];this.mesh.add(e),this.mesh.visible=!1,this.mesh.bind(this.skeleton),this.mesh.position.set(this.location_x,this.location_y,this.location_z),this.mesh.scale.set(this.meshScale,this.meshScale,this.meshScale),m.add(this.mesh),this.boneVisHelper=new Je(this.mesh,this.color1,this.color2,this.transparentBone,u),this.boneVisHelper.visible=this.showVis,m.add(this.boneVisHelper),console.log(this.boneVisHelper);const n=new Ye({color:this.color2,size:10,sizeAttenuation:!1,map:new qe().load("../models/files/disc.png"),alphaTest:.5});this.verticesVisHelper=new Ke(this.boneVisHelper.geometry,n),this.boneVisHelper.add(this.verticesVisHelper),this.transparentVertices&&(this.verticesVisHelper.material.opacity=0);const a=this.path.split("/"),s=a[a.length-1].split(".")[0],d=s.split("_")[3];var h=null;d==="corrupted"?h=s.split("_")[1]+"-"+s.split("_")[2]+"-"+s.split("_")[3]:h=s.split("_")[1]+"-"+s.split("_")[2];const f=document.createElement("div");f.className="label",f.textContent=h,f.style.color=this.color2.getStyle(),this.Label=new Qe(f),this.Label.position.copy(this.boneVisHelper.position),this.Label.visible=!1,this.showLabelinstant||(this.Label.position.y=this.Label.position.y+.05),this.tail.length!==20?(this.Label.visible=!0,this.Label.position.y=this.Label.position.y-.4):this.Label.position.x=this.Label.position.x+.2,this.boneVisHelper.add(this.Label)},setUpAnimation:function(){const t=this.animData[0][0].length,e=t===24?24:120,n=t/e,a=[],i=[],o=new O;for(let h=0;h<t;h++){a.push(h/e);let f=this.animData[0][0][h],x=this.animData[1][0][h],V=this.animData[2][0][h];o.set(f,x,V).toArray(i,i.length)}const s=".bones[bone_0].position",d=new Q(s,a,i);this.tracks.push(d);for(let h=1;h<this.head.length;h++){const f=[],x=[],V=new O;for(let w=0;w<t;w++){f.push(w/e);let G=this.head[h-1],F=this.tail[h-1],_e=this.animData[0][F][w]-this.animData[0][G][w],ve=this.animData[1][F][w]-this.animData[1][G][w],Se=this.animData[2][F][w]-this.animData[2][G][w];V.set(_e,ve,Se).toArray(x,x.length)}const ge=".bones[bone_"+h+"].position",be=new Q(ge,f,x);this.tracks.push(be)}this.clip=new Ze("Action",n,this.tracks),this.mixer=new ee(this.mesh),this.clipAction=this.mixer.clipAction(this.clip),this.clipAction.play(),y.push(this.clipAction),J.push(this.mixer)}};let m,u,c,R,g,_,C,B="Perspective",k,W,D,te,et=[],v=[];const J=[],y=[],r=[];let b;const ie=4;let S;const I=[],M={idle:{weight:1},walk:{weight:0},run:{weight:0}},E={sneak_pose:{weight:0},sad_pose:{weight:0},agree:{weight:0},headShake:{weight:0}};let l,j;tt();let P=!1,U=0;it();const se=new p("../models/files/oursgated_MTM/OursGated_gt_cover_uncorrupted.json",-1,.3,0,!1,!1,!1,!1,!1,!0);se.initContent();r.push(se);const ne=new p("../models/files/oursgated_MTM/OursGated_recon_cover_uncorrupted.json",0,.3,0,!1,!0,!1,!1,!1,!0);ne.initContent();r.push(ne);const ae=new p("../models/files/oursgated_MTM/OursGated_gt_cover_uncorrupted.json",1,.3,0,!1,!1,!1,!1,!1,!1);ae.initContent();r.push(ae);const oe=new p("../models/files/oursgated_MTM/OursGated_recon_cover_uncorrupted.json",1,.3,0,!1,!0,!1,!1,!1,!0);oe.initContent();r.push(oe);const le=new p("../models/files/Oursgated_CMU/OursGated_recon_cover_uncorrupted.json",-1.5,1.15,0,!0,!0,!1,!1,!1,!0);le.initContent();r.push(le);const re=new p("../models/files/Oursgated_CMU/OursGated_gt_cover_uncorrupted.json",-1.5,1.15,0,!0,!1,!1,!1,!1,!1);re.initContent();r.push(re);const he=new p("../models/files/Oursgated_CMU/OursGated_recon_cover_corrupted.json",-.5,1.15,0,!0,!0,!1,!1,!1,!1);he.initContent();r.push(he);const ce=new p("../models/files/Oursgated_CMU/OursGated_recon_secret_corrupted.json",.5,1.15,0,!0,!0,!1,!1,!1,!0);ce.initContent();r.push(ce);const de=new p("../models/files/Oursgated_CMU/OursGated_gt_secret_uncorrupted.json",1.5,1.15,0,!0,!1,!1,!1,!1,!1);de.initContent();r.push(de);const pe=new p("../models/files/Oursgated_CMU/OursGated_recon_secret_corrupted.json",1.5,1.15,0,!0,!0,!1,!1,!1,!0);pe.initContent();r.push(pe);function tt(){const t=document.getElementById("container");document.getElementById("file1").addEventListener("change",bt,!1),document.getElementById("file2").addEventListener("change",_t,!1);var e=document.getElementById("header"),n=document.createTextNode("CMU - Ours");e.appendChild(n),te=new $e,m=new Ce,m.background=new A(4473924),new ye(16777215,4473924).position.set(0,20,0);const i=new xe(16777215);i.position.set(3,10,10),i.castShadow=!0,i.shadow.camera.top=2,i.shadow.camera.bottom=-2,i.shadow.camera.left=-2,i.shadow.camera.right=2,i.shadow.camera.near=.1,i.shadow.camera.far=40,C=new ke(20,20,8947848),m.add(C);const o=window.innerWidth,s=window.innerHeight;c=new T(45,o/s,1,100),c.position.set(0,1,3),u=new Ae({antialias:!0}),u.setPixelRatio(window.devicePixelRatio),u.setSize(window.innerWidth,window.innerHeight),u.outputEncoding=He,u.shadowMap.enabled=!0,t.appendChild(u.domElement),ue(),fe(),g=new Me,g.setSize(window.innerWidth,window.innerHeight),g.domElement.style.position="absolute",g.domElement.style.top="0px",g.domElement.style.pointerEvents="none",t.appendChild(g.domElement),R=new De,t.appendChild(R.dom),window.addEventListener("resize",vt)}function it(){new Le().load("../models/gltf/Xbot.glb",function(e){k=e.scene,m.add(k),k.traverse(function(a){a.isMesh&&(a.castShadow=!0),a.isMesh&&(a.visible=!1)}),W=new Ee(k),W.visible=!1,m.add(W);const n=e.animations;D=new ee(k),j=n.length;for(let a=0;a!==j;++a){let i=n[a];const o=i.name;if(M[o]){const s=D.clipAction(i);$(s),M[o].action=s,I.push(s)}else if(E[o]){q.makeClipAdditive(i),i.name.endsWith("_pose")&&(i=q.subclip(i,i.name,2,3,30));const s=D.clipAction(i);$(s),E[o].action=s,I.push(s)}}st(),we()})}function ue(){_=new Pe(u);const t=new Ve(m,c);_.addPass(t),S=new Ge(Fe),S.uniforms.sourceTextureSize.value=new L(window.innerWidth,window.innerHeight),S.uniforms.sourceTexelSize.value=new L(1.5/window.innerWidth,1.5/window.innerHeight),_.addPass(S);const e=new Oe(window.innerWidth*u.getPixelRatio(),window.innerHeight*u.getPixelRatio());_.addPass(e)}function fe(){b=new We(c,u.domElement),b.enablePan=!0,b.autoRotate=!0,b.target.set(0,1,0),b.update()}function st(){const t=new ze({width:310});t.close();const e=t.addFolder("Visibility"),n=t.addFolder("Camera Controls"),a=t.addFolder("Activation/Deactivation"),i=t.addFolder("Pause Stepping"),o=t.addFolder("General Speed"),s=t.addFolder("Scale and Pos");l={"show hand demo":function(){z("hand")},"show human demo":function(){z("human")},"clear all scene object":function(){z("None")},"camera rotate":!0,"set photo mode":!1,"modify time scale":1,"deactivate all":dt,"activate all":pt,"pause/continue":ut,"make single step":mt,"modify step size":.05,"set Grid scale":1,"set Grid XY":1,"set Obj Rotate Angle":1,"bone opacity (transparent)":1,"vertices opacity (transparent)":1,"show/disable label":!0,"show/disable dilation(post-process)":!0,"perspective camera":N,"orthographic camera":N},n.add(l,"camera rotate").onChange(me),n.add(l,"set photo mode").onChange(ot),v.push(n.add(l,"perspective camera")),v.push(n.add(l,"orthographic camera")),e.add(l,"bone opacity (transparent)",0,1,1).onChange(at),e.add(l,"vertices opacity (transparent)",0,1,1).onChange(nt),e.add(l,"show/disable label").onChange(H),e.add(l,"show/disable dilation(post-process)"),a.add(l,"deactivate all"),a.add(l,"activate all"),i.add(l,"pause/continue"),i.add(l,"make single step"),i.add(l,"modify step size",.01,.1,.001),o.add(l,"modify time scale",0,1.5,.01).onChange(ct),s.add(l,"set Grid scale",.01,3,.01).onChange(lt),s.add(l,"set Grid XY",.01,2,.01).onChange(rt),s.add(l,"set Obj Rotate Angle",.01,4,.01).onChange(ht),e.open(),a.open(),i.open(),o.open(),s.open(),et.forEach(function(d){d.setInactive=function(){d.domElement.classList.add("control-inactive")},d.setActive=function(){d.domElement.classList.remove("control-inactive")};const h=M[d.property];(!h||!h.weight)&&d.setInactive()})}function H(t){r.forEach(function(e){e.boneVisHelper.visible===!0&&(e.Label.visible=t)})}function nt(t){r.forEach(function(e){e.verticesVisHelper.material.opacity=t})}function at(t){r.forEach(function(e){e.boneVisHelper.material.opacity=t})}function me(t){b.autoRotate=t,c.position.set(0,1,3)}function ot(t){t?(N(),C.rotation.x=Math.PI/2):C.rotation.x=Math.PI}function N(){c instanceof T?(c=new Te(window.innerWidth/-1e3,window.innerWidth/1e3,window.innerHeight/1e3,window.innerHeight/-1e3,1,10),c.position.x=0,c.position.y=1,c.position.z=3,B="Orthographic"):(c=new T(45,window.innerWidth/window.innerHeight,.1,1e3),c.position.x=0,c.position.y=1,c.position.z=3,B="Perspective"),ue(),fe(),me(!1)}function z(t){t==="hand"?r.forEach(function(e){e.tail.length===20?(e.boneVisHelper.visible=!0,H(l["show/disable label"])):(e.boneVisHelper.visible=!1,e.Label.visible=!1,H(l["show/disable label"]))}):t==="human"?r.forEach(function(e){e.tail.length!==20?(e.boneVisHelper.visible=!0,H(l["show/disable label"])):(e.boneVisHelper.visible=!1,e.Label.visible=!1,H(l["show/disable label"]))}):r.forEach(function(e){e.boneVisHelper.visible=!1,e.Label.visible=!1,e.path==="dummy/path"&&Y(e)})}function lt(t){C.scale.set(t,t,t)}function rt(t){C.position.set(t,t,0)}function ht(t){r.forEach(function(e){e.mesh.rotation.set(0,t,0)})}function ct(t){for(const e of J)e.timeScale=t}function dt(){y.forEach(function(t){t.stop()})}function pt(){y.forEach(function(t){t.play()})}function ut(){P?(P=!1,X()):y[0].paused?X():ft()}function ft(){y.forEach(function(t){t.paused=!0})}function X(){y.forEach(function(t){t.paused=!1})}let Z=0;function mt(){X(),P=!0,U=l["modify step size"],Z+=1,console.log(Z)}function $(t){const e=t.getClip(),n=M[e.name]||E[e.name];wt(t,n.weight),t.play()}function wt(t,e){t.enabled=!0,t.setEffectiveTimeScale(1),t.setEffectiveWeight(e)}function Y(t){t.mesh.removeFromParent(),t.boneVisHelper.removeFromParent(),m.remove(t),console.log(t.path+"has been remove"),console.log(r)}function gt(){B==="Perspective"?(v[0].disable(),v[1].enable()):(v[1].disable(),v[0].enable())}function bt(t){var e=t.target.files[0],n=new FileReader;n.onload=function(a){return function(i){const o=new p("dummy/folder_1",.5,1.15,0,!0,!1);if(o.loadDataFromFile(n.result),r.length>=ie+2){let s=r.splice(-2,1);Y(s[0])}r.push(o)}}(),n.readAsText(e)}function _t(t){var e=t.target.files[0],n=new FileReader;n.onload=function(a){return function(i){const o=new p("dummy/folder_2",-.5,.75,0,!0,!1);if(o.loadDataFromFile(n.result),r.length>=ie+2){let s=r.splice(-2,1);Y(s[0])}r.push(o)}}(),n.readAsText(e)}function vt(){c.aspect=window.innerWidth/window.innerHeight,c.updateProjectionMatrix(),u.setSize(window.innerWidth,window.innerHeight),_.setSize(window.innerWidth,window.innerHeight),S.uniforms.sourceTextureSize.value=new L(window.innerWidth,window.innerHeight),S.uniforms.sourceTexelSize.value=new L(1/window.innerWidth,1/window.innerHeight),g.setSize(window.innerWidth,window.innerHeight)}function St(){R.update(),g.render(m,c),l["show/disable dilation(post-process)"]?_.render():u.render(m,c)}function we(){requestAnimationFrame(we);for(let e=0;e!==j;++e){const n=I[e],a=n.getClip(),i=M[a.name]||E[a.name];i.weight=n.getEffectiveWeight()}gt(),b.update();let t=te.getDelta();P&&(t=U,U=0),D.update(t);for(const e of J)e.update(t);St()}
